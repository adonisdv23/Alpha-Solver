# NEW-037 Â· Determinism Gate (CI Blocker on Flaps)

Implements a replay determinism gate that runs a labeled replay set multiple
 times and fails if any run differs. The gate computes a stable hash over a
subset of the replay output and prints a minimal diff on failure. The gate is
wired into CI and exposed via `python -m service.replay.gate`.

Key features:

- defaults: `--runs 10 --seed 123 --replay-file data/datasets/replay/replay_small.jsonl`
- skips records tagged with `known_flaky` or `external_tool_missing`
- emits `PASS (N/N stable)` or `FAIL` with differences
- `--fast` mode limits runs for local iteration
- CI job uploads `gate.log` on failure
